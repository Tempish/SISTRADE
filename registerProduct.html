<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Sign Up</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-warning-subtle">

    <div class="container py-5">
        <h1 class="mb-5" id="formTitulo">Agregar producto a su cuenta</h1>

        <img src="assets/sistradelogo.png" alt="logo"
            class="img-fluid position-absolute start-50 translate-middle-x logo-sistrade" />

        <div class="card p-4 mb-4">
            <form id="addProductForm">
                <div class="mb-3">
                    <label for="prodcuctName" class="form-label">Nombre del producto</label>
                    <input type="text" class="form-control" id="productName" required>
                </div>

                <div class="mb-3">
                    <label for="marketPrice" class="form-label">Precio del mercado</label>
                    <input type="number" step="any" class="form-control" id="marketPrice" required>
                </div>

                <div class="mb-3">
                    <label for="type" class="form-label">Tipo</label>
                    <input type="text" class="form-control" id="type" required>
                </div>

                <div class="mb-3">
                    <label for="description" class="form-label">Descripcion</label>
                    <input type="text" class="form-control" id="description" required>
                </div>


                <div class="row">
                    <div class="col-md-6">
                        <button type="submit" class="btn btn custom-btn mb-2" id="btnGuardar">Agregar producto</button>


                    </div>
                    <div class="col-md-6">
                        <button onclick="window.location.href='index.html'" type="button" class="btn custom-btn"
                            id="btnGuardar">Volver a inicio</button>

                    </div>

                </div>

            </form>
        </div>
    </div>

    <script>
        const registerProductUrl = "http://localhost:8080/api/product";

        document.getElementById("addProductForm").addEventListener("submit", function (event) {
            event.preventDefault();

            const name = document.getElementById("productName").value;
            const marketPrice = parseFloat(document.getElementById("marketPrice").value);
            const type = document.getElementById("type").value;
            const description = document.getElementById("description").value;
            const ownerId = parseInt(localStorage.getItem('userId'));

            console.log('ownerID:', ownerId);
            
            const bodyData = { ownerId, marketPrice, name, type, description };
            console.log('JSON a enviar:', JSON.stringify(bodyData));
            fetch(registerProductUrl, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ ownerId, marketPrice, name, type, description })
            })
                .then(res => {
                    if (!res.ok) return res.text().then(msg => { throw new Error(msg); });
                    return res.json();
                })
                .then(data => {
                    alert("producto registrado con Ã©xito");
                    document.getElementById("addProductForm").reset();
                })
                .catch(err => {
                    alert("Error: " + err.message);
                });
        });
    </script>
</body>

</html>